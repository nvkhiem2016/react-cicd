name: Deploy CoinTap App to AWS S3

on:
  push:
    branches:
      - dev
  pull_request:
    branches:
      - staging
      - dev
    paths: 
      - "**.jsx"
      - "**.json"
      - "**.ts"
      - "**.yml"

# env:
#   AWS_S3_BUCKET: ${{secrets.AWS_S3_BUCKET}}
#   AWS_S3_REGION: ${{secrets.AWS_S3_REGION}}

jobs:
  
  deploy-staging:
    runs-on: ubuntu-latest
    environment: staging
    name: "Upload app to AWS S3"
    permissions:
      id-token: write
      contents: read
    steps:
      - name: Configure AWS Credentials
        uses: aws-actions/configure-aws-credentials@v1
        with:
          role-to-assume: arn:aws:iam::815538845682:role/GitHubOIDC
          aws-region: ${{secrets.AWS_S3_REGION}}

      

      - name: Copy files to the test website with the AWS CLI
        run: |
          echo hello world > ./hello_world.txt
          aws s3 sync ./hello_world.txt s3://${{secrets.AWS_S3_BUCKET}} --delete
